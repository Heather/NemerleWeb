using Nemerle.Collections;
using Nemerle.Xml;
using Nemerle.Extensions;

using System;
using System.Text;
using System.Linq;
using System.Console;
using System.Collections.Generic;
using System.Xml.Linq;

using NemerleWeb;
using NemerleWeb.TypedJS;

//[assembly: GenerateTypedJS(
// Root = "A",
// Files = [ (@"d:\MyProjects\NemerleWeb\NemerleWeb.TypedJS\Scripts\typings") ]
//)]

module Program
{
  Main() : void
  {
    def result = NWeb Test();
    
    foreach (s in NWebData.GetAllScriptNames())
    {
      WriteLine(NWebData.GetScript(s));
      WriteLine(NWebData.GetLambdasScript(s));
    }    
    
    WriteLine(result);
    _ = Console.ReadKey();
  }
}

[Unit]
public class Test
{  
  public Children : string = "abcdefghijklm";
  public Children2 : string = "nopqrstuvwxyz";
  
  public this()
  {
    def f1(letters) {
      
    }
       
    f1(Children);
    def a1 = Children.Where(c => c == 'a');
    
    foreach(a2 in Children2.Select(c : char => c + "1")) {
      def b = a2;
    }
    
    def f1(letters) {
      
    }
    
    def f2(letters, func) : IEnumerable[string] {
      letters.Select(func)
    }
    
    def a3 = f1(Children);
    def a4 = f2(Children2, c : char => c + "2");
  }
  
  [Html]
  public View() : string
  {
    <# 
       <div>
         <div $foreach(c in Children.Where(c => c != 'f'))>
           <strong data-id="1">$(c + 'a')</strong>
           <span $foreach(c2 in Children2.Where(c => c != 'z'))>
             $c2
             <div $when(c2 == 'p')>
              it's p $c2
             </div>
           </span>
         </div>
       </div>
       <div>
        2
       </div>
    #>
  }  
}
